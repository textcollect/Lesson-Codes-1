-- MySQL Script generated by MySQL Workbench
-- Sat May 13 15:27:51 2023
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION';

-- -----------------------------------------------------
-- Schema onepostdb
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `onepostdb` ;

-- -----------------------------------------------------
-- Schema onepostdb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `onepostdb` DEFAULT CHARACTER SET utf8 ;
USE `onepostdb` ;

-- -----------------------------------------------------
-- Table `onepostdb`.`Users`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `onepostdb`.`Users` ;

CREATE TABLE IF NOT EXISTS `onepostdb`.`Users` (
  `user_id` INT NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(45) NOT NULL,
  `password` VARCHAR(255) NOT NULL,
  `email` VARCHAR(255) NOT NULL,
  `role` VARCHAR(200) NOT NULL,
  `enabled` TINYINT NULL,
  `creation` DATETIME NULL DEFAULT NOW(),
  PRIMARY KEY (`user_id`),
  UNIQUE INDEX `username_UNIQUE` (`username` ASC) VISIBLE,
  UNIQUE INDEX `email_UNIQUE` (`email` ASC) VISIBLE,
  UNIQUE INDEX `idUserAccount_UNIQUE` (`user_id` ASC) VISIBLE)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `onepostdb`.`Post`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `onepostdb`.`Post` ;

CREATE TABLE IF NOT EXISTS `onepostdb`.`Post` (
  `idPost` INT UNSIGNED NOT NULL AUTO_INCREMENT,
  `postTitle` VARCHAR(45) NOT NULL,
  `postDescribe` VARCHAR(100) NOT NULL,
  `postFull` VARCHAR(3000) NOT NULL,
  `postTime` DATETIME NULL DEFAULT NOW() COMMENT '\'YYYY-MM-DD hh:mm:ss\'',
  `user_id` INT NULL COMMENT 'set to NULL when UserAccount is deleted.',
  PRIMARY KEY (`idPost`),
  UNIQUE INDEX `idPosts_UNIQUE` (`idPost` ASC) VISIBLE,
  INDEX `fk_Posts_UserAccounts_idx` (`user_id` ASC) VISIBLE,
  CONSTRAINT `fk_Posts_UserAccounts`
    FOREIGN KEY (`user_id`)
    REFERENCES `onepostdb`.`Users` (`user_id`)
    ON DELETE SET NULL
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `onepostdb`.`Reply`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `onepostdb`.`Reply` ;

CREATE TABLE IF NOT EXISTS `onepostdb`.`Reply` (
  `idReply` INT NOT NULL AUTO_INCREMENT,
  `replyText` VARCHAR(500) NULL,
  `replyTime` DATETIME NULL DEFAULT NOW(),
  `user_id` INT NULL,
  `idPost` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`idReply`, `idPost`),
  INDEX `fk_Replies_UserAccounts1_idx` (`user_id` ASC) VISIBLE,
  INDEX `fk_Replies_Posts1_idx` (`idPost` ASC) VISIBLE,
  CONSTRAINT `fk_Replies_UserAccounts1`
    FOREIGN KEY (`user_id`)
    REFERENCES `onepostdb`.`Users` (`user_id`)
    ON DELETE SET NULL
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Replies_Posts1`
    FOREIGN KEY (`idPost`)
    REFERENCES `onepostdb`.`Post` (`idPost`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `onepostdb`.`PostReply`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `onepostdb`.`PostReply` ;

CREATE TABLE IF NOT EXISTS `onepostdb`.`PostReply` (
  `idPost` INT UNSIGNED NOT NULL,
  `idReply` INT NOT NULL,
  PRIMARY KEY (`idPost`, `idReply`),
  INDEX `fk_Posts_has_Replies_Replies1_idx` (`idReply` ASC) VISIBLE,
  INDEX `fk_Posts_has_Replies_Posts1_idx` (`idPost` ASC) VISIBLE,
  CONSTRAINT `fk_Posts_has_Replies_Posts1`
    FOREIGN KEY (`idPost`)
    REFERENCES `onepostdb`.`Post` (`idPost`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION,
  CONSTRAINT `fk_Posts_has_Replies_Replies1`
    FOREIGN KEY (`idReply`)
    REFERENCES `onepostdb`.`Reply` (`idReply`)
    ON DELETE CASCADE
    ON UPDATE NO ACTION)
ENGINE = InnoDB;


-- -----------------------------------------------------
-- Table `onepostdb`.`UAPost`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `onepostdb`.`UAPost` ;

CREATE TABLE IF NOT EXISTS `onepostdb`.`UAPost` (
  `user_id` INT NULL,
  `idPost` INT UNSIGNED NOT NULL,
  PRIMARY KEY (`idPost`),
  INDEX `fk_UserAccounts_has_Posts_Posts1_idx` (`idPost` ASC) VISIBLE,
  INDEX `fk_UserAccounts_has_Posts_UserAccounts1_idx` (`user_id` ASC) VISIBLE,
  UNIQUE INDEX `idPost_UNIQUE` (`idPost` ASC) VISIBLE,
  CONSTRAINT `fk_UserAccounts_has_Posts_UserAccounts1`
    FOREIGN KEY (`user_id`)
    REFERENCES `onepostdb`.`Users` (`user_id`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `fk_UserAccounts_has_Posts_Posts1`
    FOREIGN KEY (`idPost`)
    REFERENCES `onepostdb`.`Post` (`idPost`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB;

USE `onepostdb`;

DELIMITER $$

USE `onepostdb`$$
DROP TRIGGER IF EXISTS `onepostdb`.`Post_AFTER_INSERT` $$
USE `onepostdb`$$
CREATE DEFINER = CURRENT_USER TRIGGER `onepostdb`.`Post_AFTER_INSERT` AFTER INSERT ON `Post` FOR EACH ROW
BEGIN
	INSERT INTO `UAPost` (user_id, idPost)
    VALUES
    (NEW.user_id, NEW.idPost);
END$$


USE `onepostdb`$$
DROP TRIGGER IF EXISTS `onepostdb`.`Post_AFTER_DELETE` $$
USE `onepostdb`$$
CREATE DEFINER = CURRENT_USER TRIGGER `onepostdb`.`Post_AFTER_DELETE` AFTER DELETE ON `Post` FOR EACH ROW
BEGIN
	DELETE FROM `UAPost`
    WHERE idPost = OLD.idPost;
	DELETE FROM `PostReply`
    WHERE idPost = OLD.idPost;
    DELETE FROM `Reply`
    WHERE idPost = OLD.idPost;
END$$


USE `onepostdb`$$
DROP TRIGGER IF EXISTS `onepostdb`.`Reply_AFTER_INSERT` $$
USE `onepostdb`$$
CREATE DEFINER = CURRENT_USER TRIGGER `onepostdb`.`Reply_AFTER_INSERT` AFTER INSERT ON `Reply` FOR EACH ROW
BEGIN
	INSERT INTO `PostReply` (idPost, idReply)
    VALUES
    (NEW.idPost, NEW.idReply);
END$$


USE `onepostdb`$$
DROP TRIGGER IF EXISTS `onepostdb`.`Reply_AFTER_DELETE` $$
USE `onepostdb`$$
CREATE DEFINER = CURRENT_USER TRIGGER `onepostdb`.`Reply_AFTER_DELETE` AFTER DELETE ON `Reply` FOR EACH ROW
BEGIN
	DELETE FROM `PostReply`
    WHERE idPost = OLD.idPost;
END$$


DELIMITER ;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

-- -----------------------------------------------------
-- Data for table `onepostdb`.`Users`
-- -----------------------------------------------------
START TRANSACTION;
USE `onepostdb`;
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (1, 'admin', '$2a$10$st2mUBRkpXYPwLvMTGTvsuu.hQtRW9.3T1Wfhc8dbk4kZTXljISSG', 'admin@tp.edu.sg', 'ROLE_ADMIN', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (2, 'kitboga', '$2a$10$ZB/pQkS4T2A27oZbi4TEJOOlXLdkyWdHncQGfnJH/zr51TWHoSyuW', 'bestgoats@yahoo.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (3, 'tom', '$2a$10$PTPrzbHXfumC4U///wZ5xOlHQ92v1bmW2h.DCGreTHxfuGcTIbS9C', 'tomcat@gmail.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (4, 'pierogi', '$2a$10$4VXnKUdE8ZGnXG69E4pXkeRjRz5ylubtI8eI/re8ttNI0jd076pAy', 'pierogi@gmail.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (5, 'scammerpayback', '$2a$10$0TBwAB3s2yjh8F7fuO6J1uUDtNcEaI/U5oOnt4O9bXbiBWwSXO7qm', 'scammerpayback@gmail.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (6, 'thestockguy', '$2a$10$rAsxj3lFeQrUnJv2n3yzu.a/1iw3hrRdDc0NLsTBtidPV30GtuQtS', 'tsg@gmail.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (7, 'esther', '$2a$10$hGQSHfYlDtTK1E4oGLGAaOaGgCXYph1kQWdBL.MSgFEua6T/jpJ0K', 'bestgoats@aol.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (8, 'anderson', '$2a$10$SmP1bf4IzYTZCvhM9TEV6.wkKfuXZBp0q6L9.9srvdvCxsSNaZRLq', 'anderson001@tp.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (9, 'xyzTheOne', '$2a$10$dNMs0PUtKtPFuCKxPbScAewUDYXmcRUXYc8N7zmL2O9L3gEe1fAI.', 'kekw123@gmail.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (10, 'firstUser', '$2a$10$3YG9mbucgXKzsot9nWeEweBpBQYa0/SU8JsjvOpNaYA9rTxZ/RPRC', 'alphacenturion@gmail.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');
INSERT INTO `onepostdb`.`Users` (`user_id`, `username`, `password`, `email`, `role`, `enabled`, `creation`) VALUES (11, 'Number2', '$2a$10$gMAa9h2Z.2fFoarQp.D6R.asBcAh6pfSAQQ7W8WvZ8bB1wgZ341V2', 'lukeskywalker@disney.com', 'ROLE_USER', 1, '2023-05-11 00:31:27');

/*
-- Query: select * from Reply
LIMIT 0, 1000

-- Date: 2023-05-11 00:56
*/
INSERT INTO `onepostdb`.`Post` (`idPost`,`postTitle`,`postDescribe`,`postFull`,`postTime`,`user_id`) VALUES (1,'title 1','description 1','full-length 1','2023-05-10 17:20:29',1);
INSERT INTO `onepostdb`.`Post` (`idPost`,`postTitle`,`postDescribe`,`postFull`,`postTime`,`user_id`) VALUES (2,'title 2','description 2','full-length 2','2023-05-10 17:20:35',1);
INSERT INTO `onepostdb`.`Post` (`idPost`,`postTitle`,`postDescribe`,`postFull`,`postTime`,`user_id`) VALUES (3,'title 3','description 2','full-length 2','2023-05-10 17:20:37',2);
INSERT INTO `onepostdb`.`Post` (`idPost`,`postTitle`,`postDescribe`,`postFull`,`postTime`,`user_id`) VALUES (4,'title 4','description 4','full-length 2','2023-05-10 23:59:55',3);
INSERT INTO `onepostdb`.`Post` (`idPost`,`postTitle`,`postDescribe`,`postFull`,`postTime`,`user_id`) VALUES (5,'new story','from front end before working on deployment','new story from front end','2023-05-13 15:06:05',3);

INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (1,'Nice post!','2023-05-11 00:14:30',1,1);
INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (2,'Great story!','2023-05-11 00:14:36',2,1);
INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (3,'cool story','2023-05-11 00:14:45',3,1);
INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (4,'this was really great','2023-05-11 00:14:47',1,1);
INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (5,'amazing as always','2023-05-11 00:14:51',3,1);
INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (6,'i always look forwad to your posts','2023-05-11 00:14:52',1,2);
INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (7,'nice one','2023-05-11 00:14:54',3,3);
INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (8,'Great! Been a while since I read something so satisfying','2023-05-11 00:14:55',2,3);
INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (9,'Yeah, true','2023-05-11 00:14:58',4,3);
INSERT INTO `onepostdb`.`Reply` (`idReply`,`replyText`,`replyTime`,`user_id`,`idPost`) VALUES (10,'I just feel like posting a reply here to not break my streak...','2023-05-11 00:14:59',2,2);

COMMIT;

